{"version":3,"file":"editor-lib.mjs","sources":["../../../projects/editor-lib/src/lib/editor-lib.service.ts","../../../projects/editor-lib/src/lib/editor-lib.component.ts","../../../projects/editor-lib/src/lib/editor-lib.component.html","../../../projects/editor-lib/src/lib/editor-lib.module.ts","../../../projects/editor-lib/src/public-api.ts","../../../projects/editor-lib/src/editor-lib.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class EditorLibService {\r\n\r\n  constructor() { }\r\n}\r\n","import { Component, EventEmitter, Input, OnInit, Output } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from \"@angular/common/http\";\r\nimport { CKEditor4 } from 'ckeditor4-angular/ckeditor';\r\n\r\ndeclare const CKEDITOR;\r\n\r\n\r\n@Component({\r\n  selector: 'mail-editor',\r\n  templateUrl: './editor-lib.component.html',\r\n  styles: [\r\n  ]\r\n})\r\nexport class EditorLibComponent implements OnInit {\r\n\r\n  @Input() htmlText:string = '';\r\n  @Input() jwtToken:string = '';\r\n  @Output() changeEvent = new EventEmitter();\r\n\r\n  public placeholders:string[] = [];\r\n\r\n  private placeHolderObj:any[] = [];\r\n\r\n  constructor(private http:HttpClient) { }\r\n\r\n  change(event) {\r\n    this.changeEvent.emit(CKEDITOR.currentInstance.getData())\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    let httpOptions = {\r\n      headers: new HttpHeaders({\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${this.jwtToken}`\r\n      })\r\n    };\r\n    const observableTokens = this.http.get<string[]>('https://ua-api.selcomm.com/Messages/Metatags?api-version=1.0', httpOptions);\r\n    observableTokens.subscribe(tokens => {\r\n      this.placeholders = tokens\r\n      this.placeHolderObj = this.setPlaceholdersIds(this.placeholders)\r\n    });\r\n  }\r\n\r\n  setPlaceholdersIds(placeholders:any[]):any[] {\r\n    let result: any[] = [];\r\n    placeholders.forEach((placeholdes, index) => {\r\n      result.push({id: index, name: placeholdes});\r\n    })\r\n    return result;\r\n  }\r\n\r\n  onEditorReady(event) {\r\n    CKEDITOR.plugins.load('textmatch', (_) => {\r\n    })\r\n    CKEDITOR.plugins.load('autocomplete', (_) => {\r\n      new CKEDITOR.plugins.autocomplete(event.editor, {\r\n        textTestCallback: this.textTestCallback,\r\n        dataCallback: this.dataCallback,\r\n        itemTemplate: '<li data-id=\"{id}\">' +\r\n                      '<div><strong class=\"item-title\">{name}</strong></div>' +\r\n                      '</li>',\r\n        outputTemplate: '[[{name}]]<span>&nbsp;</span>',\r\n      });\r\n    })\r\n  }\r\n\r\n  public textTestCallback = (range) => {\r\n    if (!range.collapsed) {\r\n      return null;\r\n    }\r\n    return CKEDITOR.plugins.textMatch.match(range, this.matchCallback);\r\n  };\r\n\r\n  public matchCallback = (text, offset) => {\r\n    const pattern = /\\[{2}([A-z]|\\])*$/;\r\n    const match = text.slice(0, offset).match(pattern);\r\n    if (!match) {\r\n      return null;\r\n    }\r\n    return { start: match.index, end: offset };\r\n  };\r\n\r\n  public dataCallback = (matchInfo, callback) => {\r\n    const data = this.placeHolderObj.filter(function (item) {\r\n      const itemName = '[[' + item.name + ']]';\r\n      return itemName.indexOf(matchInfo.query.toLowerCase()) == 0;\r\n    });\r\n    callback(data);\r\n  };\r\n}\r\n","<ckeditor [data]=\"htmlText\" (ready)=\"onEditorReady($event)\" (change)=\"change($event)\" ></ckeditor>\r\n","import { NgModule } from '@angular/core';\r\nimport { EditorLibComponent } from './editor-lib.component';\r\nimport { CKEditorModule } from 'ckeditor4-angular';\r\nimport { HttpClientModule } from '@angular/common/http';\r\n\r\n\r\n@NgModule({\r\n  declarations: [\r\n    EditorLibComponent\r\n  ],\r\n  imports: [\r\n    CKEditorModule,\r\n    HttpClientModule\r\n  ],\r\n  exports: [\r\n    EditorLibComponent\r\n  ]\r\n})\r\nexport class EditorLibModule { }\r\n","/*\r\n * Public API Surface of editor-lib\r\n */\r\n\r\nexport * from './lib/editor-lib.service';\r\nexport * from './lib/editor-lib.component';\r\nexport * from './lib/editor-lib.module';\r\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":[],"mappings":"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"}